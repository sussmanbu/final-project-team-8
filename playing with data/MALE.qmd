---
title: "Male Data Cleaning"
editor: visual
---

```{r "Reading Data and Initializing Packages"}
suppressMessages(library(readxl))
suppressMessages(library(tidyverse))

# Uncomment the following two commands if you have not run this file previously after Dylan made the changes

# acs_data_test <- read_excel("dataset/acsfinale.xlsx")
# write_csv(acs_data, file = here::here('dataset', 'ACS_data_rendered.csv'))

acs_data <- read.csv('dataset/ACS_data_rendered.csv')

state_names <- c("Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming", "Puerto Rico")

race_names <- c("White Alone", "White alone, not Hispanic or Latino", "Black Alone", "American Indian or Alaska Native Alone", "Asian Alone", "Native Hawaiian and Other Pacific Islander Alone", "Some other race Alone", "Two or more races", "Hispanic or Latino Origin")
```

```{r}
create_dataframe <- function(race_names, state_names, acs_data) {
  race_data <- list()
  for (race in race_names) {
    state_data <- list()
    for (index in 1:51) {
      state = state_names[index]
      multiplier <- which(race_names == race) 
      string2 <- rep("*", multiplier)
      label <- paste("Bachelor's degree or higher", paste(string2, collapse = ""), 
                     sep = "")
      filtered_data <- filter(acs_data, Label == label)
      number <- 9 + 12 * (index - 1)
      state_data[[state]] <- tibble(
        State = state,
        Years = filtered_data$Years,
        Percentage = filtered_data[[paste0("...", number)]],
        Race = race
      )
    }
    combined_state <- bind_rows(state_data)
    race_data[[race]] <- combined_state
  }
  # if you want separate tables for each race, comment out this line of data
  race_data <- bind_rows(race_data)

  return(race_data)
}

male_data <- create_dataframe(race_names, state_names, acs_data)
```


```{r}
write_csv(male_data, here::here('dataset', 'ACS_Male_Final.csv'))
```